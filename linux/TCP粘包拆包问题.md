# TCP粘包拆包问题
参考文档：
TCP 粘包/拆包的原因及解决方法：https://www.jianshu.com/p/7947991db5a3
Netty对http协议解析原理解析：https://www.toutiao.com/i6688860974310490627/

java NIO学习时发现，如果客户端连续不断的向服务端发送数据时，服务端接收的数据会出现两个包粘在一起的情况，这就是TCP协议中经常出现的粘包拆包问题。  
发生TCP粘包拆包问题的原因有很多
* 常见的几个可能如下：  
1. 要发送的数据大于TCP发送缓存的剩余空间大小，将会发生拆包问题
2. 要发送数据大于MSS(最大报文长度)，TCP在传输前将进行拆包
3. 要发送的数据小于TCP发送缓冲区的大小，TCP将多次写入缓冲区的数据一次发送出去，将发送粘包
4. 接收端的应用层没有及时读取接收缓冲区的数据，将发生粘包

通过分析发现解决问题的关键是如何给每个数据包添加边界
* 常见的的解决方案如下：
1. 发送端给每个数据包添加包首尾，首部中包含数据包的长度，这样接收端在接收到数据后，通过读取包首部的长度字段，便知道每个数据包的实际长度。
2. 发送端将每个数据包封装成固定长度（不够的可以补0填充），这样接收端每次从缓冲区读取固定长度的数据自然而然把每个数据包拆分出来。
3. 可以在数据包之间设置边界，如添加特殊符号，这样接收端通过这个边界就可以将不同的数据包拆分开来。

